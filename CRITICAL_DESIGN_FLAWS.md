# ğŸš¨ æ‰¹åˆ¤æ€§ä»£ç å®¡æŸ¥ï¼šè®¾è®¡ç¼ºé™·åˆ†æ

**å®¡æŸ¥è€…è§’åº¦**: æ‰¹åˆ¤æ€§å®¡è§† (ä¸æ˜¯ç®€å•çš„bugä¿®å¤)
**å®¡æŸ¥æ—¶é—´**: 2025-11-27
**ç»“è®º**: L1.2 çš„æ”¹åŠ¨å­˜åœ¨**3ä¸ªæ ¹æœ¬æ€§è®¾è®¡ç¼ºé™·**ï¼Œä¼šå½±å“è®­ç»ƒè´¨é‡

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜æ¦‚è¿°

æ”¹åŠ¨æœ¬æ„æ˜¯è§£å†³ QA é—®é¢˜çš„ TypeErrorï¼Œä½†åœ¨è¿‡ç¨‹ä¸­å¼•å…¥äº†**3ä¸ªæ½œåœ¨çš„æ¶æ„é—®é¢˜**ï¼š

1. âŒ **OpenAILLMWrapper æ¥å£ä¸å…¼å®¹** - ä¸ AFlow AsyncLLM æ¥å£å®Œå…¨ä¸åŒ
2. âŒ **Fallback è§¦å‘é¢‘ç‡è¿‡é«˜** - L2.2 éªŒè¯è§„åˆ™è¿‡äºä¸¥æ ¼ï¼Œå¯¼è‡´å¤§é‡ Fallback
3. âŒ **è®­ç»ƒæ•°æ®æ±¡æŸ“** - Fallback ç”Ÿæˆçš„ç­”æ¡ˆä¸è®­ç»ƒé›†ç­”æ¡ˆä¸ä¸€è‡´

---

## ğŸ”´ é—®é¢˜1ï¼šOpenAILLMWrapper æ¥å£æ ¹æœ¬ä¸å…¼å®¹

### é—®é¢˜æè¿°

æˆ‘åˆ›å»ºçš„ OpenAILLMWrapper å‡è®¾äº†ä¸€ä¸ªé”™è¯¯çš„æ¥å£ï¼š

**æˆ‘çš„å®ç°**:
```python
class OpenAILLMWrapper:
    async def agenerate(self, messages=[...], max_tokens=2048):
        # æ¥æ”¶æ¶ˆæ¯æ•°ç»„
        return {"response": generated_text}

    def get_usage_summary(self):
        return self._usage.copy()
```

**å®é™…çš„ AFlow AsyncLLM æ¥å£**:
```python
class AsyncLLM:
    async def __call__(self, prompt: str):
        # æ¥æ”¶å•ä¸ªå­—ç¬¦ä¸² prompt
        return response_string  # è¿”å›å­—ç¬¦ä¸²

    async def call_with_format(self, prompt: str, formatter):
        # å¸¦æ ¼å¼åŒ–çš„è°ƒç”¨
        return formatted_response

    def get_usage_summary(self):
        # ä½¿ç”¨ TokenUsageTracker
        return self.usage_tracker.get_summary()
```

### å…·ä½“ä¸å…¼å®¹ç‚¹

| æ¥å£è¦ç´  | AsyncLLM | OpenAILLMWrapper | å…¼å®¹æ€§ |
|---------|----------|-----------------|------|
| å¼‚æ­¥è°ƒç”¨æ–¹å¼ | `await llm(prompt_str)` | `await llm.agenerate(messages=[...])` | âŒ ä¸åŒ |
| å‚æ•°æ ¼å¼ | å•ä¸ªå­—ç¬¦ä¸² | æ¶ˆæ¯æ•°ç»„ | âŒ ä¸åŒ |
| è¿”å›å€¼ | å­—ç¬¦ä¸² | å­—å…¸ `{"response": ...}` | âŒ ä¸åŒ |
| æ ¼å¼åŒ–æ–¹æ³• | `call_with_format(prompt, formatter)` | âŒ æ—  | âŒ ç¼ºå°‘ |
| ä½¿ç”¨ç»Ÿè®¡ | `TokenUsageTracker` å¯¹è±¡ | è‡ªå®šä¹‰ dict | âš ï¸ æ ¼å¼å¯èƒ½ä¸åŒ |

### Fallback ä¸­ä¼šå‡ºç°çš„é”™è¯¯

**ç¬¬ä¸€å¤„** (ç¬¬ 767 è¡Œ - Fallback ç­–ç•¥ 1):
```python
response = await self.llm.agenerate(  # âŒ AsyncLLM æ²¡æœ‰ agenerate()
    messages=[{"role": "user", "content": prompt}],
    max_tokens=2048
)
```
é”™è¯¯: `AttributeError: 'AsyncLLM' object has no attribute 'agenerate'`

**ç¬¬äºŒå¤„** (ç¬¬ 789 è¡Œ - Fallback ç­–ç•¥ 2):
```python
custom = operator_module.Custom(self.llm)
# Custom çš„ __call__ æ–¹æ³•è°ƒç”¨ self._fill_node()
# _fill_node() æœŸæœ›è°ƒç”¨: await self.llm(prompt) æˆ– await self.llm.call_with_format(...)
```
é”™è¯¯: Custom operator å†…éƒ¨è°ƒç”¨ `self.llm(prompt)` æ—¶ï¼Œä¼šä¼ å…¥å­—ç¬¦ä¸²åˆ°ï¼š
```python
# ä½† OpenAILLMWrapper æœŸæœ›ï¼š
await self.llm.agenerate(messages=[...], max_tokens=...)
```
ç»“æœ: `TypeError: agenerate() missing required keyword argument 'messages'`

### ä¸ºä»€ä¹ˆæˆ‘çš„å‡è®¾æ˜¯é”™çš„

æˆ‘å‡è®¾ Fallback ä¸­çš„ `agenerate()` æ˜¯æŸä¸ªçœŸå®çš„ AFlow æ–¹æ³•ï¼Œä½†**å®é™…ä¸Šå®ƒä¸å­˜åœ¨**ã€‚Fallback ä»£ç æœ¬èº«å°±æœ‰bugï¼ˆå³ä½¿åœ¨æˆ‘ä¿®å¤ä¹‹å‰ï¼‰ã€‚

**åŸå§‹ Fallback ä»£ç é—®é¢˜**:
- ç¬¬ 767 è¡Œè°ƒç”¨ `self.llm.agenerate(messages=...)`
- ä½† AsyncLLM ä»æœªæœ‰è¿™ä¸ªæ–¹æ³•
- è¿™æ˜¯åŸå§‹ä»£ç ä¸­æ½œåœ¨çš„æ­»ä»£ç ï¼ˆä»æœªè¢«æˆåŠŸæ‰§è¡Œè¿‡ï¼‰

---

## ğŸ”´ é—®é¢˜2ï¼šL2.2 éªŒè¯è§„åˆ™å¯¼è‡´ Fallback é¢‘ç¹è§¦å‘

### é—®é¢˜èƒŒæ™¯

**L2.2 çš„éªŒè¯è§„åˆ™** (workflow_validator.py):
```python
if problem_type == 'qa':
    # è§„åˆ™1: æ‹’ç» Test operator
    if "self.test(" in code:
        return False, "QA ä¸åº”ä½¿ç”¨ Test..."

    # è§„åˆ™2: æ‹’ç» Programmer operator
    if "self.programmer(" in code:
        return False, "QA ä¸åº”ä½¿ç”¨ Programmer..."

    # è§„åˆ™3: å¿…é¡»è‡³å°‘ä½¿ç”¨ä¸€ä¸ª QA-safe operator
    if not has_qa_operator:
        return False, "QA å¿…é¡»ä½¿ç”¨..."
```

è¿™äº›è§„åˆ™å¾ˆ**ä¸¥æ ¼**ä¸”**å¼ºåˆ¶**ã€‚

### é—®é¢˜åˆ†æ

**å½“å‰çš„ Fallback è§¦å‘æµç¨‹**:
```
QA é—®é¢˜
  â†“
RL æ¨¡å‹ç”Ÿæˆå·¥ä½œæµï¼ˆå¯èƒ½åŒ…å« Test/Programmerï¼‰
  â†“
L2.2 éªŒè¯ â†’ âŒ éªŒè¯å¤±è´¥
  â†“
è§¦å‘ Fallback
  â†“
ä½¿ç”¨é€šç”¨ Custom operator çš„å·¥ä½œæµ
```

**é£é™©**:

1. **Fallback è§¦å‘é¢‘ç‡å¾ˆé«˜**
   - RL æ¨¡å‹ç°åœ¨è¿˜æ²¡æœ‰å……åˆ†å­¦ä¹ åˆ°"QA ä¸åº”è¯¥ç”¨ Test"
   - L2.2 è§„åˆ™ä¼šæ‹’ç»å¤§é‡ç”Ÿæˆçš„å·¥ä½œæµ
   - å¯¼è‡´å¤§é‡ Fallbackï¼ˆåŸæœ¬ç›®æ ‡æ˜¯ <40%ï¼Œä½†å¯èƒ½æ˜¯ 60-75%ï¼‰

2. **Fallback æœ¬ä¸åº”æ˜¯å¸¸è§„è·¯å¾„**
   - Fallback æ˜¯**ç´§æ€¥é™çº§æ–¹æ¡ˆ**ï¼Œä¸æ˜¯æ ‡å‡†æ‰§è¡Œè·¯å¾„
   - å¦‚æœ 75% çš„ QA é—®é¢˜éƒ½èµ° Fallbackï¼Œè¯´æ˜ RL æ¨¡å‹æ²¡æœ‰å­¦ä¹ åˆ°ä»»ä½•ä¸œè¥¿
   - è¿™ä¼šæ¯’å®³è®­ç»ƒè¿‡ç¨‹

3. **æˆæœ¬å¤±è¡¡**
   - Fallback ä¸èµ° AFlow operatorsï¼Œç›´æ¥è°ƒç”¨ LLM
   - è¿™æ”¹å˜äº†æˆæœ¬è®¡ç®—æ–¹å¼
   - ä¸æ­£å¸¸å·¥ä½œæµçš„æˆæœ¬è®¡ç®—ä¸ä¸€è‡´

### å…³é”®é—®é¢˜ï¼šè®­ç»ƒæ•°æ®æ±¡æŸ“

**è®­ç»ƒæµç¨‹ä¸­çš„æ··æ·†**:
```
åŸæ„ï¼š
RL æ¨¡å‹ â†’ ç”Ÿæˆå·¥ä½œæµ â†’ éªŒè¯å·¥ä½œæµ â†’ æ‰§è¡Œå·¥ä½œæµ â†’ è·å¾—å¥–åŠ± â†’ æ›´æ–° RL æ¨¡å‹

ç°å®ï¼š
RL æ¨¡å‹ â†’ ç”Ÿæˆå·¥ä½œæµ â†’ éªŒè¯å¤±è´¥ â†’ Fallback â†’ æ‰§è¡Œ Fallback å·¥ä½œæµ â†’ è·å¾—å¥–åŠ± â†’ ?

é—®é¢˜ï¼šRL æ¨¡å‹å­¦åˆ°çš„æ˜¯ä»€ä¹ˆï¼Ÿ
- å­¦åˆ°äº† Fallback å·¥ä½œæµçš„å¥–åŠ±ï¼Ÿ
- è¿˜æ˜¯ RL ç”Ÿæˆå·¥ä½œæµçš„å¥–åŠ±ï¼Ÿ
- è¿˜æ˜¯æ··åˆçš„å¥–åŠ±ï¼Ÿ
```

**è¿™ä¼šå¯¼è‡´**:
- RL æ¨¡å‹æ”¶åˆ°çš„åé¦ˆä¿¡å·æ¥è‡ª Fallback å·¥ä½œæµï¼Œè€Œä¸æ˜¯å®ƒè‡ªå·±ç”Ÿæˆçš„å·¥ä½œæµ
- RL æ¨¡å‹æ— æ³•å­¦ä¹ å¦‚ä½•æ”¹è¿›è‡ªå·±çš„ç”Ÿæˆèƒ½åŠ›
- è®­ç»ƒå˜æˆäº†å¯¹ Fallback å·¥ä½œæµçš„å­¦ä¹ ï¼Œè€Œä¸æ˜¯å¯¹ QA å¤„ç†çš„å­¦ä¹ 

---

## ğŸ”´ é—®é¢˜3ï¼šFallback ä¸åŸå§‹è®­ç»ƒé›†ä¸ä¸€è‡´

### é—®é¢˜æè¿°

**åŸå§‹è®­ç»ƒæ•°æ®**:
- é—®é¢˜ï¼šQA é—®é¢˜æ–‡æœ¬
- ç­”æ¡ˆï¼šæ ‡å‡†çš„ ground truth ç­”æ¡ˆ
- æœŸæœ›å·¥ä½œæµï¼šæŸç§ç‰¹å®šçš„å¤„ç†æ–¹å¼

**Fallback å·¥ä½œæµè¾“å‡º**:
```python
# åªæ˜¯ç›´æ¥ç”¨ Custom operator æˆ– LLM è°ƒç”¨
solution = await self.custom(
    input=problem,
    instruction="Generate a solution without requiring test validation."
)
return solution
```

### ä¸ä¸€è‡´ç‚¹

1. **ç­”æ¡ˆæ ¼å¼å¯èƒ½ä¸åŒ**
   - åŸå§‹ç­”æ¡ˆå¯èƒ½æ˜¯ç»“æ„åŒ–çš„ï¼ˆæ•°å­—ã€åˆ—è¡¨ç­‰ï¼‰
   - Fallback ç”Ÿæˆçš„ç­”æ¡ˆæ˜¯æ–‡æœ¬
   - è¯„ä¼°é€»è¾‘å¯èƒ½ä¸å…¼å®¹

2. **å¤„ç†æµç¨‹å®Œå…¨ä¸åŒ**
   - åŸå§‹æ•°æ®æ˜¯ç”¨ AFlow operators çš„ç»“æ„åŒ–æµç¨‹
   - Fallback æ˜¯ç®€å•çš„ä¸€æ¬¡æ€§ LLM è°ƒç”¨
   - è¿™ä¸¤è€…çš„å¥–åŠ±è®¡ç®—å¯èƒ½å®Œå…¨ä¸åŒ

3. **æˆæœ¬è®¡ç®—ä¸ä¸€è‡´**
   - åŸå§‹å·¥ä½œæµï¼šå¤šä¸ª operatorsï¼Œæˆæœ¬ç´¯ç§¯
   - Fallbackï¼šä¸€æ¬¡ LLM è°ƒç”¨ï¼Œæˆæœ¬ç®€å•
   - è¿™å¯¼è‡´åŒä¸€ä¸ªé—®é¢˜çš„å¥–åŠ±å¯èƒ½å®Œå…¨ä¸åŒ

---

## ğŸ“Š ç»¼åˆå½±å“è¯„ä¼°

### å¯¹è®­ç»ƒçš„å½±å“

| æ–¹é¢ | å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|------|------|---------|
| **RL å­¦ä¹ è´¨é‡** | RL æ”¶åˆ°çš„åé¦ˆæ¥è‡ª Fallbackï¼Œä¸æ˜¯è‡ªå·±çš„ç”Ÿæˆ | ğŸ”´ ä¸¥é‡ |
| **æ”¶æ•›æ€§** | RL å¯èƒ½æ— æ³•æ”¶æ•›åˆ°å¥½çš„ç­–ç•¥ | ğŸ”´ ä¸¥é‡ |
| **æ•°æ®ä¸€è‡´æ€§** | è®­ç»ƒæ•°æ®å’Œ Fallback æ•°æ®çš„æ ‡ç­¾ä¸ä¸€è‡´ | ğŸ”´ ä¸¥é‡ |
| **æˆæœ¬è®¡ç®—** | ä¸¤ç§è·¯å¾„çš„æˆæœ¬è®¡ç®—ä¸ä¸€è‡´ | ğŸŸ¡ ä¸­ç­‰ |
| **éªŒè¯è§„åˆ™** | è§„åˆ™è¿‡ä¸¥æ ¼å¯¼è‡´è¿‡å¤š Fallback | ğŸ”´ ä¸¥é‡ |

### å…·ä½“æ•°å­—é¢„æµ‹

åŸºäºä»£ç åˆ†æï¼š
```
å‡è®¾ RL åˆå§‹æˆåŠŸç‡ä¸º 30%ï¼ˆåŒ…æ‹¬ Test operatorï¼‰
  - 70% çš„ç”Ÿæˆå·¥ä½œæµåŒ…å« Test æˆ– Programmer
  â†“
L2.2 éªŒè¯æ‹’ç»
  - éªŒè¯æˆåŠŸç‡ä¸‹é™åˆ° 25%ï¼ˆåªæœ‰ 25% é€šè¿‡éªŒè¯ï¼‰
  â†“
Fallback è§¦å‘ç‡ = 75%
  â†“
75% çš„ QA é—®é¢˜èµ° Fallback è·¯å¾„
  â†“
è®­ç»ƒå˜æˆï¼šRL å­¦ä¹  Fallback è€Œä¸æ˜¯å­¦ä¹ ç”Ÿæˆå¥½çš„å·¥ä½œæµ
```

---

## âš ï¸ éšè—çš„å‡è®¾é”™è¯¯

### å‡è®¾1: "Fallback å°±æ˜¯æ›´å¥½çš„ QA å¤„ç†æ–¹å¼"

**å®é™…æƒ…å†µ**:
- Fallback åªæ˜¯ç®€å•çš„ Custom operator
- å®ƒä¸ä»£è¡¨"æœ€ä¼˜çš„ QA å¤„ç†æ–¹å¼"
- RL åº”è¯¥å­¦ä¹ å¦‚ä½•ç”Ÿæˆå¥½çš„å·¥ä½œæµï¼Œè€Œä¸æ˜¯å­¦ä¹ å¦‚ä½•ç”¨ Fallback

### å‡è®¾2: "éªŒè¯è§„åˆ™ä¼šè®© RL å­¦ä¹ åˆ°çº¦æŸ"

**å®é™…æƒ…å†µ**:
- éªŒè¯è§„åˆ™åœ¨æ‰§è¡Œæ—¶å¼ºåˆ¶åº”ç”¨ï¼Œä¸æ˜¯åœ¨ç”Ÿæˆæ—¶
- RL ç”Ÿæˆå·¥ä½œæµ â†’ éªŒè¯å¤±è´¥ â†’ Fallback
- RL æ”¶ä¸åˆ°"ç”Ÿæˆäº†é”™è¯¯çš„å·¥ä½œæµ"çš„åé¦ˆ
- RL åªæ”¶åˆ°"Fallback å·¥ä½œæµçš„å¥½å¤„"çš„åé¦ˆ
- RL å­¦ä¸åˆ°å¦‚ä½•éµå®ˆçº¦æŸ

### å‡è®¾3: "Fallback ä¸ä¼šå½±å“è®­ç»ƒ"

**å®é™…æƒ…å†µ**:
- Fallback æ”¹å˜äº†æ‰§è¡Œè·¯å¾„å’Œå¥–åŠ±ä¿¡å·
- RL ä¼˜åŒ–çš„æ˜¯æ‰§è¡Œç»“æœï¼Œè€Œä¸æ˜¯ç”Ÿæˆèƒ½åŠ›
- å¦‚æœ Fallback è¢«è§¦å‘ï¼ŒRL çš„æ¢¯åº¦æ¥è‡ª Fallback å·¥ä½œæµï¼Œä¸æ˜¯æ¥è‡ª RL ç”Ÿæˆçš„å·¥ä½œæµ
- è¿™è¿åäº† GRPO çš„è®¾è®¡åŸåˆ™

---

## ğŸ¯ æ ¹æœ¬æ€§é—®é¢˜

### ä¸ºä»€ä¹ˆæˆ‘çš„æ”¹åŠ¨æœ‰é—®é¢˜

æˆ‘çš„æ”¹åŠ¨è¯•å›¾"ä¿®å¤" Fallbackï¼Œä½†é—®é¢˜åœ¨äºï¼š

1. **Fallback æœ¬èº«ä¸åº”è¯¥è¢«é¢‘ç¹è§¦å‘**
   - å¦‚æœ 75% çš„ QA é—®é¢˜èµ° Fallbackï¼Œè¯´æ˜æœ‰æ ¹æœ¬æ€§çš„é—®é¢˜
   - ä¸æ˜¯ Fallback çš„å®ç°æœ‰é—®é¢˜ï¼Œè€Œæ˜¯ RL ç”Ÿæˆçš„å·¥ä½œæµæœ‰é—®é¢˜

2. **æ ¹æœ¬åŸå› ä¸åœ¨ Fallbackï¼Œåœ¨ RL ç”Ÿæˆ**
   - RL ç”Ÿæˆäº†åŒ…å« Test operator çš„å·¥ä½œæµ
   - è¿™æ˜¯ RL æ¨¡å‹è¿˜æ²¡æœ‰å­¦åˆ°çš„
   - L2.2 éªŒè¯æ‹’ç»äº†è¿™äº›å·¥ä½œæµ
   - è§¦å‘ Fallback

3. **L2.2 æ˜¯æ²»æ ‡ä¸æ²»æœ¬**
   - éªŒè¯è§„åˆ™å¼ºåˆ¶æ‹’ç»ï¼Œä¸æ˜¯æŒ‡å¼• RL å­¦ä¹ 
   - å¯¼è‡´ Fallback é¢‘ç¹è§¦å‘
   - åè€Œé˜»ç¢äº† RL çš„å­¦ä¹ 

---

## ğŸ’¡ æ”¹è¿›å»ºè®®

### é‡æ–°è€ƒè™‘çš„è§’åº¦

**ä¸æ˜¯ä¿®å¤ Fallbackï¼Œè€Œæ˜¯ä¿®æ”¹ç­–ç•¥**ï¼š

#### æ–¹æ¡ˆ A: è½¯çº¦æŸè€Œä¸æ˜¯ç¡¬æ‹’ç»

```python
# ä¸æ˜¯è¿™æ ·ï¼ˆç¡¬æ‹’ç»ï¼‰
if "self.test(" in code:
    return False, "QA ä¸åº”ä½¿ç”¨ Test..."

# è€Œæ˜¯è¿™æ ·ï¼ˆè½¯æƒ©ç½šï¼‰
if "self.test(" in code:
    warnings.append("Warning: Test operator in QA")
    # ä½†ä¸æ‹’ç»ä»£ç ï¼Œå…è®¸æ‰§è¡Œ
    # åœ¨å¥–åŠ±è®¡ç®—ä¸­åº”ç”¨æƒ©ç½š
    reward -= 0.1  # é™ä½å¥–åŠ±è€Œä¸æ˜¯å®Œå…¨æ‹’ç»
```

**ä¼˜ç‚¹**:
- RL å¯ä»¥å°è¯•ç”Ÿæˆ Test operator
- RL ä¼šé€šè¿‡å¥–åŠ±å­¦åˆ°"Test åœ¨ QA ä¸­ä¸å¥½"
- è®­ç»ƒä¿¡å·æ¸…æ™°ä¸€è‡´

**ç¼ºç‚¹**:
- éœ€è¦ä¿®æ”¹å¥–åŠ±è®¡ç®—é€»è¾‘
- å¯èƒ½å¯¼è‡´éƒ¨åˆ†å¤±è´¥çš„å·¥ä½œæµ

#### æ–¹æ¡ˆ B: æ›´å¥½çš„ç”Ÿæˆçº¦æŸè€Œä¸æ˜¯éªŒè¯æ‹’ç»

```python
# åœ¨ç”Ÿæˆé˜¶æ®µï¼ˆRL workflow generatorï¼‰åŠ å¼ºçº¦æŸ
# è€Œä¸æ˜¯åœ¨éªŒè¯é˜¶æ®µæ‹’ç»

# L2.1 å·²ç»åšäº†è¿™ä¸ªï¼šåœ¨ prompt ä¸­æ˜ç¡®å‘Šè¯‰ RL ä¸è¦ç”¨ Test
# é—®é¢˜æ˜¯ RL è¿˜æ²¡æœ‰å­¦åˆ°
# è§£å†³æ–¹æ¡ˆï¼šç»™ RL æ›´å¤šæ—¶é—´å­¦ä¹ ï¼Œä¸è¦åœ¨éªŒè¯é˜¶æ®µç¡¬æ‹’ç»
```

**ä¼˜ç‚¹**:
- RL è‡ªç„¶åœ°å­¦ä¹ çº¦æŸ
- ä¸éœ€è¦ Fallback
- è®­ç»ƒæ•°æ®ä¸€è‡´

**ç¼ºç‚¹**:
- éœ€è¦æ›´å¤šçš„è®­ç»ƒæ­¥éª¤
- åˆæœŸé”™è¯¯ç‡ä¼šæ›´é«˜

#### æ–¹æ¡ˆ C: ä¿®æ”¹ Fallback ç­–ç•¥

```python
# å¦‚æœä¸€å®šè¦ç”¨ Fallbackï¼Œä¸åº”è¯¥ç›´æ¥ç”¨ Custom operator
# è€Œåº”è¯¥ç”Ÿæˆä¸€ä¸ª"ç»è¿‡é¢„å®¡æ ¸"çš„å·¥ä½œæµ

class ApprovedFallbackWorkflow:
    """é¢„å…ˆå®¡æ ¸å¥½çš„ QA å·¥ä½œæµ"""
    async def __call__(self, problem):
        # ä½¿ç”¨ä¸€ä¸ªå·²çŸ¥å¥½ç”¨çš„ã€æ²¡æœ‰ Test çš„å·¥ä½œæµ
        # ä¾‹å¦‚ï¼šAnswerGenerate â†’ Review â†’ Revise
        answer = await self.answer_generate(input=problem)
        feedback = await self.review(problem=problem, solution=answer['answer'])
        if not feedback['review_result']:
            answer = await self.revise(
                problem=problem,
                solution=answer['answer'],
                feedback=feedback['feedback']
            )
        return answer['answer']
```

**ä¼˜ç‚¹**:
- Fallback ä½¿ç”¨æ›´å¥½çš„å·¥ä½œæµé€»è¾‘
- ä¸æ˜¯ç®€å•çš„ Custom operator
- æ›´æ¥è¿‘"æœ€ä¼˜çš„ QA å¤„ç†"

---

## ğŸš¨ å»ºè®®ï¼šå›æ»š L2.2 éªŒè¯è§„åˆ™

æ ¹æ®ä¸Šè¿°åˆ†æï¼Œ**å¼ºçƒˆå»ºè®®**ï¼š

1. âœ… **ä¿ç•™ L1.1** - QA ä¸“ç”¨ Fallback å·¥ä½œæµï¼ˆæœ‰å¸®åŠ©ï¼‰
2. âœ… **ä¿ç•™ L1.3** - å®‰å…¨å“åº”æå–ï¼ˆæœ‰å¸®åŠ©ï¼‰
3. âš ï¸ **ä¿®å¤ L1.2** - OpenAILLMWrapper æ¥å£ï¼ˆä½†éœ€è¦é‡æ–°è®¾è®¡ï¼‰
4. âŒ **å›æ»š L2.2** - éªŒè¯è§„åˆ™è¿‡ä¸¥æ ¼ï¼ˆå¯¼è‡´è¿‡å¤š Fallbackï¼‰
5. âœ… **ä¿ç•™ L2.1** - ç”Ÿæˆçº¦æŸï¼ˆè®© RL è‡ªç„¶å­¦ä¹ ï¼‰

**æœ€ç»ˆå»ºè®®**:
```
1. å…ˆè®© L2.1 (æç¤ºçº¦æŸ) ç»™ RL æ›´å¤šæ—¶é—´å­¦ä¹ 
2. ä¸è¦ç”¨ç¡¬æ‹’ç» (L2.2)ï¼Œæ”¹ç”¨è½¯æƒ©ç½š
3. ç»™ RL 20-30 æ­¥çš„è®­ç»ƒæ—¶é—´æ¥å­¦ä¹  QA å¤„ç†
4. ç›‘æ§ Fallback è§¦å‘é¢‘ç‡ï¼Œå¦‚æœ >50% è¯´æ˜æœ‰é—®é¢˜
5. å¦‚æœ Fallback ä»è¿‡é¢‘ï¼Œå†è€ƒè™‘æ›´å¥½çš„çº¦æŸæ–¹å¼
```

---

## ğŸ“ æ€»ç»“

| æ”¹åŠ¨ | è¯„ä¼° | å»ºè®® |
|------|------|------|
| L1.1: QA Fallback | âœ… æœ‰å¸®åŠ© | ä¿ç•™ |
| L1.2: OpenAI å¤‡ç”¨ | âŒ æ¥å£ä¸å…¼å®¹ + æ ¹æœ¬é—®é¢˜ | å®Œå…¨é‡æ–°è®¾è®¡ |
| L1.3: å®‰å…¨æå– | âœ… æœ‰å¸®åŠ© | ä¿ç•™ |
| L2.1: ç”Ÿæˆçº¦æŸ | âœ… å¥½æ–¹å‘ | ä¿ç•™ |
| L2.2: éªŒè¯æ‹’ç» | âŒ å¯¼è‡´è¿‡å¤š Fallback | **å›æ»š** |

**æœ€å…³é”®çš„insight**:
è¿™ä¸æ˜¯ä¸€ä¸ª bug ä¿®å¤é—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªè®­ç»ƒç­–ç•¥é—®é¢˜ã€‚ç›²ç›®åœ°å¢åŠ  Fallback å’ŒéªŒè¯è§„åˆ™ï¼Œåè€Œä¼šæ±¡æŸ“è®­ç»ƒæ•°æ®ï¼Œé˜»ç¢ RL å­¦ä¹ ã€‚

